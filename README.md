# A股财务数据抓取工具

## 简介

本程序是一个强大的 A 股上市公司财务数据分析工具，使用 AKShare 库获取上市公司财务报表数据，自动计算关键财务指标，并支持与去年同期数据进行对比分析。程序会自动生成美观的 Excel 文件，包含格式化的财务指标表格，便于投资者进行财务分析和投资决策。

## 主要功能

### 📊 财务数据获取
- **自动获取三表数据**：利润表、现金流量表、资产负债表
- **多期数据对比**：支持查询多个报告期的数据
- **智能字段匹配**：自动识别不同财务报表中的字段名称
- **数据清洗**：自动处理缺失值和异常数据

### 📈 财务指标计算
程序自动计算以下财务指标：

**利润表指标**：
- 营业收入及增长率
- 毛利率（毛利/营业收入）
- 营业利润率（营业利润/营业收入）
- 净利润率（净利润/营业收入）
- 归母净利润

**ROE 分析**：
- 归母净利润率
- 总资产周转率（营业收入/平均总资产）
- 权益乘数（平均总资产/平均净资产）
- ROE（归母净利润率 × 总资产周转率 × 权益乘数）

**现金流量分析**：
- 经营活动现金流量净额
- 净利润现金保障倍数（经营现金流/净利润）
- 投资活动现金流量净额
- 销售商品提供劳务收到的现金
- 现金收入比率（现金收入/营业收入）

**资产负债分析**：
- 资产负债率（总负债/总资产）
- 流动比率（流动资产/流动负债）
- 净资产

**估值指标**：
- 市值（期末股价 × 总股本）
- PE / PB / PS（结合期末市值与财报口径重新计算）
- 最新估值（实时股价、市值及时间，含接口失败时的兜底算法）

### 🎨 Excel 导出功能
- **美观格式化**：使用微软雅黑字体，不加粗，行高优化
- **分区显示**：按财务报表类型分区展示
- **颜色区分**：不同的数据区域使用不同颜色
- **自动布局**：冻结首行，网格线隐藏，列宽自适应
- **数值格式化**：金额自动转换为万元/亿元，百分比显示

## 环境配置

### 1. 安装 Conda

如果还没有安装 Conda，请先下载并安装 [Miniconda](https://docs.conda.io/en/latest/miniconda.html) 或 [Anaconda](https://www.anaconda.com/download)。

### 2. 创建 Conda 环境

在项目目录下打开终端，执行以下命令创建新的 Conda 环境：

```bash
conda create -n datacapture python=3.10
```

### 3. 激活环境

```bash
conda activate datacapture
```

### 4. 安装依赖

```bash
pip install akshare pandas openpyxl
```

或者使用 requirements.txt（如果存在）：

```bash
pip install -r requirements.txt
```

## 使用方法

### 基本用法

程序运行后会自动生成 Excel 文件到当前目录。

查询单只股票（默认查询 600418）：

```bash
python akshare_financials.py
```

查询指定股票：

```bash
python akshare_financials.py --symbol 600418
```

查询多只股票：

```bash
python akshare_financials.py --symbols 600418 000333 601012
```

### 指定 Excel 输出路径

将结果导出为指定名称的 Excel 文件：

```bash
python akshare_financials.py --symbol 600418 --excel analysis.xlsx
```

多股票模式下，可以指定输出目录（每只股票生成单独的文件）：

```bash
python akshare_financials.py --symbols 600418 000333 --excel ./reports/
```

### 多股票批量分析

```bash
python akshare_financials.py --symbols 600418 000001 600036 000002 --excel ./financial_analysis/
```

### 自定义报告期

默认查询以下报告期：
- 2025三季报 (2025-09-30)
- 2025中报 (2025-06-30)
- 2025一季报 (2025-03-31)
- 2024年报 (2024-12-31)

可以通过 `--report` 参数自定义报告期：

```bash
python akshare_financials.py --symbol 600418 --report 2024Q3 2024-09-30 2024Q2 2024-06-30 2024Q1 2024-03-31
```

注意：`--report` 参数需要成对出现（报告期名称 和 日期）。

### 查看帮助

```bash
python akshare_financials.py --help
```

## 输出说明

程序会自动生成 Excel 文件，包含以下财务指标：

### 📊 Excel 文件结构

Excel 文件按以下分区组织：

**【利润表】**（按顺序显示）：
- 营业收入、本期值/去年同期值
- 营业收入增长率、本期值/去年同期值
- 毛利率、本期值/去年同期值
- 营业利润率、本期值/去年同期值
- 净利润率、本期值/去年同期值
- 净利润、本期值/去年同期值
- 归母净利润、本期值/去年同期值

**【ROE】**（按顺序显示）：
- 归母净利润率、本期值/去年同期值
- 总资产周转率、本期值/去年同期值
- 权益乘数、本期值/去年同期值
- ROE、本期值/去年同期值

**【现金流量表】**（按顺序显示）：
- 经营活动现金流量净额、本期值/去年同期值
- 净利润现金保障倍数、本期值/去年同期值
- 投资活动现金流量净额、本期值/去年同期值
- 销售商品提供劳务收到的现金、本期值/去年同期值
- 现金收入比率、本期值/去年同期值

**【资产负债表】**：
- 资产负债率、本期值/去年同期值
- 流动比率、本期值/去年同期值
- 净资产、本期值/去年同期值

**【估值】**：
- 市值、PE、PB、PS、本期值/去年同期值
- 估值（同列展示股价、市值、对应时间）

**【最后估值】**：
- 最新PE、最新PB、最新PS
- 最新估值（实时股价、市值、获取时间）

### 🎨 Excel 格式特色

- **分区标题**：用橙色背景突出显示各报表分区
- **指标名称**：蓝色背景，微软雅黑字体
- **数值显示**：金额自动格式化为万元/亿元，百分比显示为%
- **对比分析**：每列显示本期值和去年同期值
- **视觉优化**：行高1.5倍，隔行换色，网格线隐藏

## 技术特点

### 🔧 数据处理
- **容错性强**：自动处理数据缺失和异常情况
- **智能计算**：杜邦分析法计算 ROE
- **多期对比**：支持年同比和环比分析
- **格式化输出**：数值按行业标准格式显示

### 📋 参数说明
- `--symbol`：单只股票代码（如 600418）
- `--symbols`：多只股票代码（空格分隔）
- `--excel`：Excel 输出路径（文件或目录）
- `--report`：自定义报告期（成对出现：名称 日期）

## 注意事项

1. **股票代码格式**：支持 6 位数字代码，程序自动识别沪深交易所
2. **网络依赖**：数据来自 AKShare 库，需要稳定的网络连接
3. **数据时效性**：财务数据会随上市公司披露而更新
4. **Excel 兼容性**：生成的 Excel 文件兼容主流办公软件
5. **批量处理**：多股票分析时每只股票生成独立文件
6. **实时估值**：尝试从 AKShare 获取实时行情；若接口不可用，将使用最新收盘价与总股本回算。

## 示例输出

运行 `python akshare_financials.py --symbol 600418`